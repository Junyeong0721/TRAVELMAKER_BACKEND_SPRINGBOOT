-- 1. 유저 테이블
CREATE TABLE MEMBER (
    IDX BIGINT AUTO_INCREMENT PRIMARY KEY,
    USER_ID VARCHAR(100) NOT NULL UNIQUE,
    USER_EMAIL VARCHAR(100) NOT NULL UNIQUE,  -- 추가됨 (중복 방지 UNIQUE)
    USER_PW VARCHAR(255) NOT NULL,
    NICKNAME VARCHAR(50) NOT NULL,
    MBTI VARCHAR(10),
    USER_COMMENT VARCHAR(200),
    TITLE VARCHAR(50) DEFAULT '새내기 여행자',
    STATUS TINYINT(1) DEFAULT 0,              -- 0(정상), 1(탈퇴)
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2. 팔로우 및 즐겨찾기 테이블
CREATE TABLE FOLLOW (
    IDX BIGINT AUTO_INCREMENT PRIMARY KEY,
    FOLLOW_IDX BIGINT NOT NULL,            -- 팔로우를 누른 사람 (나)
    FOLLOWING_IDX BIGINT NOT NULL,         -- 팔로우를 받은 사람 (친구)
    FAVORITE_YN CHAR(1) DEFAULT 'N',       -- 추가: 즐겨찾기 여부 (Y/N)
    DELETE_YN CHAR(1) DEFAULT 'N',
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (FOLLOW_IDX) REFERENCES MEMBER(IDX),
    FOREIGN KEY (FOLLOWING_IDX) REFERENCES MEMBER(IDX),
    UNIQUE KEY unique_follow (FOLLOW_IDX, FOLLOWING_IDX)
);

-- 3. 플래너 테이블
CREATE TABLE PLANS (
    IDX BIGINT AUTO_INCREMENT PRIMARY KEY,
    USER_IDX BIGINT NOT NULL,
    TITLE VARCHAR(100) NOT NULL,
    IS_AI TINYINT(1) DEFAULT 0,
    DELETE_YN CHAR(1) DEFAULT 'N',
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (USER_IDX) REFERENCES MEMBER(IDX)
);

-- 4. 플래너 상세 테이블
CREATE TABLE PLAN_DETAIL (
    IDX BIGINT AUTO_INCREMENT PRIMARY KEY,
    PLAN_IDX BIGINT NOT NULL,              -- 컬럼명 통일 (PLAN_ID -> PLAN_IDX)
    PLAN_TITLE VARCHAR(100) NOT NULL,
    VISIT_ORDER INT NOT NULL,
    TYPES VARCHAR(100),                    -- 쉼표 수정
    VISIT_TIME TIME,
    MEMO TEXT,
    ADDRESS VARCHAR(255),
    FOREIGN KEY (PLAN_IDX) REFERENCES PLANS(IDX) ON DELETE CASCADE
);

-- 5. 게시판 테이블
CREATE TABLE POSTS (
    IDX         BIGINT AUTO_INCREMENT PRIMARY KEY,
    USER_IDX    BIGINT NOT NULL,
    PLAN_IDX    BIGINT,
    TITLE       VARCHAR(200) NOT NULL,
    CONTENT     TEXT,                        -- 에디터의 HTML 내용이 들어감
    THUMBNAIL   VARCHAR(255),                -- ✅ 서버에 저장된 썸네일 파일명 (추가됨)
    STATUS      VARCHAR(20) DEFAULT 'PUBLISHED',
    VIEW_COUNT  INT DEFAULT 0,               -- 조회수 기능
    CREATE_AT   TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (USER_IDX) REFERENCES MEMBER(IDX),
    FOREIGN KEY (PLAN_IDX) REFERENCES PLANS(IDX)
);

use travelmaker_db;

select * from POSTS;

-- 6. 댓글 테이블
CREATE TABLE COMMENTS (
    IDX BIGINT AUTO_INCREMENT PRIMARY KEY,
    POST_IDX BIGINT NOT NULL,
    USER_IDX BIGINT NOT NULL,
    CONTENT TEXT NOT NULL,
    DELETE_YN CHAR(1) DEFAULT 'N',
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (POST_IDX) REFERENCES POSTS(IDX),
    FOREIGN KEY (USER_IDX) REFERENCES MEMBER(IDX)
);

-- 7. 좋아요 테이블
CREATE TABLE LIKES (
    IDX BIGINT AUTO_INCREMENT PRIMARY KEY,
    POST_IDX BIGINT NOT NULL,
    USER_IDX BIGINT NOT NULL,
    CREATE_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (POST_IDX) REFERENCES POSTS(IDX),
    FOREIGN KEY (USER_IDX) REFERENCES MEMBER(IDX),
    UNIQUE KEY unique_like (POST_IDX, USER_IDX)
);